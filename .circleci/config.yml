version: 2.1
jobs:
  machine: true
  steps:
    - checkout
    - run:
      name: enable ipv6
      command: |
        cat <<'EOF' | sudo tee /etc/docker/daemon.json
        {
          "ipv6": true,
          "fixed-cidr-v6": "2001:db8:1::/64"
        }
        EOF
        sudo service docker restart
  build:
    docker:
      - image: circleci/golang:1.11
    working_directory: /go/src/github.com/libp2p/go-libp2p-quic-transport
    steps:
      - checkout
      - run:
          name: "Setup build environment"
          command: |
            make deps
      - run:
          name: "Build infos"
          command: |
            go version
      - run:
          name: "Run tests"
          command: ginkgo -r -v --randomizeAllSpecs --randomizeSuites --trace --progress --race
